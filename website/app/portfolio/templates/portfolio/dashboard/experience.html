{% extends 'portfolio/dashboard/base.html' %}
{% load static %}

{% block title %}Experience Management - Dashboard{% endblock %}

{% block breadcrumb %}
<span class="separator">/</span>
<span>Experience</span>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header Section -->
    <div class="dashboard-card">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
                <h1 class="text-2xl font-bold text-primary mb-2">Experience Management</h1>
                <p class="text-secondary">Manage your work experience, skills, and education timeline.</p>
            </div>
            <div class="flex items-center gap-3">
                <a href="{% url 'admin:portfolio_experience_add' %}" class="btn btn-primary">
                    <i data-feather="plus"></i>
                    Add Experience
                </a>
                <a href="{% url 'admin:portfolio_skill_add' %}" class="btn btn-secondary">
                    <i data-feather="award"></i>
                    Add Skill
                </a>
            </div>
        </div>
    </div>

    <!-- Experience Timeline -->
    <div class="dashboard-card">
        <div class="card-header">
            <h2 class="card-title">Work Experience</h2>
            <a href="{% url 'admin:portfolio_experience_add' %}" class="btn btn-secondary btn-sm">
                <i data-feather="plus"></i>
                Add Experience
            </a>
        </div>
        
        {% if experiences %}
        <div class="space-y-6">
            {% for experience in experiences %}
            <div class="relative">
                <!-- Timeline Line -->
                {% if not forloop.last %}
                <div class="absolute left-6 top-12 w-0.5 h-full bg-accent"></div>
                {% endif %}
                
                <div class="flex gap-4">
                    <!-- Timeline Dot -->
                    <div class="flex-shrink-0 w-12 h-12 bg-primary rounded-full flex items-center justify-center text-white relative z-10">
                        {% if experience.is_current %}
                        <i data-feather="play" class="w-5 h-5"></i>
                        {% else %}
                        <i data-feather="briefcase" class="w-5 h-5"></i>
                        {% endif %}
                    </div>
                    
                    <!-- Experience Content -->
                    <div class="flex-1 bg-surface rounded-lg p-6">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="text-lg font-semibold text-primary">{{ experience.role }}</h3>
                                    {% if experience.is_current %}
                                    <span class="badge badge-success">Current</span>
                                    {% endif %}
                                </div>
                                
                                <div class="flex items-center gap-4 text-sm text-secondary mb-3">
                                    <div class="flex items-center gap-1">
                                        <i data-feather="building" class="w-4 h-4"></i>
                                        <span>{{ experience.company }}</span>
                                    </div>
                                    {% if experience.location %}
                                    <div class="flex items-center gap-1">
                                        <i data-feather="map-pin" class="w-4 h-4"></i>
                                        <span>{{ experience.location }}</span>
                                    </div>
                                    {% endif %}
                                    <div class="flex items-center gap-1">
                                        <i data-feather="calendar" class="w-4 h-4"></i>
                                        <span>
                                            {{ experience.start_date|date:"M Y" }} - 
                                            {% if experience.is_current %}Present{% else %}{{ experience.end_date|date:"M Y" }}{% endif %}
                                        </span>
                                    </div>
                                </div>
                                
                                {% if experience.description %}
                                <p class="text-secondary mb-4">{{ experience.description|linebreaks }}</p>
                                {% endif %}
                            </div>
                            
                            <div class="flex items-center gap-2">
                                <a href="{% url 'admin:portfolio_experience_change' experience.id %}" 
                                   class="btn btn-secondary btn-sm">
                                    <i data-feather="edit-2" class="w-4 h-4"></i>
                                    Edit
                                </a>
                                <button class="btn btn-danger btn-sm btn-icon-only" 
                                        onclick="deleteExperience({{ experience.id }})"
                                        data-tooltip="Delete">
                                    <i data-feather="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-12">
            <div class="w-16 h-16 bg-accent rounded-full flex items-center justify-center mx-auto mb-4">
                <i data-feather="briefcase" class="w-8 h-8 text-secondary"></i>
            </div>
            <h3 class="text-lg font-semibold text-primary mb-2">No Experience Added</h3>
            <p class="text-secondary mb-4">Start building your professional timeline by adding your work experience.</p>
            <a href="{% url 'admin:portfolio_experience_add' %}" class="btn btn-primary">
                <i data-feather="plus"></i>
                Add First Experience
            </a>
        </div>
        {% endif %}
    </div>

    <!-- Skills Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Skills Management -->
        <div class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">Skills</h2>
                <a href="{% url 'admin:portfolio_skill_add' %}" class="btn btn-secondary btn-sm">
                    <i data-feather="plus"></i>
                    Add Skill
                </a>
            </div>
            
            {% if skill_categories %}
            <div class="space-y-6">
                {% for category, skills in skill_categories.items %}
                <div>
                    <h3 class="text-lg font-medium text-primary mb-4">{{ category }}</h3>
                    <div class="space-y-3">
                        {% for skill in skills %}
                        <div class="flex items-center justify-between p-4 bg-surface rounded-lg">
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-medium text-primary">{{ skill.name }}</h4>
                                    <span class="text-sm text-secondary">{{ skill.proficiency }}%</span>
                                </div>
                                <div class="w-full bg-accent rounded-full h-2">
                                    <div class="bg-primary h-2 rounded-full transition-all duration-300" 
                                         style="width: {{ skill.proficiency }}%"></div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2 ml-4">
                                <a href="{% url 'admin:portfolio_skill_change' skill.id %}" 
                                   class="btn btn-secondary btn-sm btn-icon-only">
                                    <i data-feather="edit-2" class="w-4 h-4"></i>
                                </a>
                                <button class="btn btn-danger btn-sm btn-icon-only" 
                                        onclick="deleteSkill({{ skill.id }})"
                                        data-tooltip="Delete">
                                    <i data-feather="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-8">
                <div class="w-12 h-12 bg-accent rounded-full flex items-center justify-center mx-auto mb-3">
                    <i data-feather="award" class="w-6 h-6 text-secondary"></i>
                </div>
                <h3 class="font-semibold text-primary mb-2">No Skills Added</h3>
                <p class="text-secondary text-sm mb-4">Showcase your expertise by adding your skills.</p>
                <a href="{% url 'admin:portfolio_skill_add' %}" class="btn btn-primary btn-sm">
                    <i data-feather="plus"></i>
                    Add First Skill
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Education -->
        <div class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">Education</h2>
                <a href="{% url 'admin:portfolio_education_add' %}" class="btn btn-secondary btn-sm">
                    <i data-feather="plus"></i>
                    Add Education
                </a>
            </div>
            
            {% if education %}
            <div class="space-y-4">
                {% for edu in education %}
                <div class="p-4 bg-surface rounded-lg">
                    <div class="flex items-start justify-between gap-4">
                        <div class="flex-1">
                            <h3 class="font-semibold text-primary">{{ edu.degree }}</h3>
                            {% if edu.field_of_study %}
                            <p class="text-sm text-secondary mb-1">{{ edu.field_of_study }}</p>
                            {% endif %}
                            <div class="flex items-center gap-4 text-sm text-muted">
                                <div class="flex items-center gap-1">
                                    <i data-feather="book" class="w-4 h-4"></i>
                                    <span>{{ edu.institution }}</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i data-feather="calendar" class="w-4 h-4"></i>
                                    <span>
                                        {{ edu.start_year }} - 
                                        {% if edu.end_year %}{{ edu.end_year }}{% else %}Present{% endif %}
                                    </span>
                                </div>
                            </div>
                            {% if edu.description %}
                            <p class="text-sm text-secondary mt-2">{{ edu.description }}</p>
                            {% endif %}
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <a href="{% url 'admin:portfolio_education_change' edu.id %}" 
                               class="btn btn-secondary btn-sm btn-icon-only">
                                <i data-feather="edit-2" class="w-4 h-4"></i>
                            </a>
                            <button class="btn btn-danger btn-sm btn-icon-only" 
                                    onclick="deleteEducation({{ edu.id }})"
                                    data-tooltip="Delete">
                                <i data-feather="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-8">
                <div class="w-12 h-12 bg-accent rounded-full flex items-center justify-center mx-auto mb-3">
                    <i data-feather="book" class="w-6 h-6 text-secondary"></i>
                </div>
                <h3 class="font-semibold text-primary mb-2">No Education Added</h3>
                <p class="text-secondary text-sm mb-4">Add your educational background and qualifications.</p>
                <a href="{% url 'admin:portfolio_education_add' %}" class="btn btn-primary btn-sm">
                    <i data-feather="plus"></i>
                    Add Education
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="dashboard-card">
        <div class="card-header">
            <h2 class="card-title">Experience Overview</h2>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="text-center p-4 bg-surface rounded-lg">
                <div class="text-2xl font-bold text-primary mb-1">{{ experiences.count }}</div>
                <div class="text-sm text-secondary">Total Positions</div>
            </div>
            
            <div class="text-center p-4 bg-surface rounded-lg">
                <div class="text-2xl font-bold text-success mb-1">
                    {{ experiences|length|default:0 }}
                </div>
                <div class="text-sm text-secondary">Years Experience</div>
            </div>
            
            <div class="text-center p-4 bg-surface rounded-lg">
                <div class="text-2xl font-bold text-info mb-1">
                    {% for category, skills in skill_categories.items %}{{ skills|length }}{% if not forloop.last %} + {% endif %}{% endfor %}
                </div>
                <div class="text-sm text-secondary">Skills Listed</div>
            </div>
            
            <div class="text-center p-4 bg-surface rounded-lg">
                <div class="text-2xl font-bold text-warning mb-1">{{ education.count }}</div>
                <div class="text-sm text-secondary">Qualifications</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Delete experience
function deleteExperience(experienceId) {
    if (confirm('Are you sure you want to delete this experience? This action cannot be undone.')) {
        // In a real implementation, this would make an AJAX call
        Dashboard.showToast('Experience deleted successfully', 'success');
        setTimeout(() => location.reload(), 1000);
    }
}

// Delete skill
function deleteSkill(skillId) {
    if (confirm('Are you sure you want to delete this skill? This action cannot be undone.')) {
        // In a real implementation, this would make an AJAX call
        Dashboard.showToast('Skill deleted successfully', 'success');
        setTimeout(() => location.reload(), 1000);
    }
}

// Delete education
function deleteEducation(educationId) {
    if (confirm('Are you sure you want to delete this education entry? This action cannot be undone.')) {
        // In a real implementation, this would make an AJAX call
        Dashboard.showToast('Education entry deleted successfully', 'success');
        setTimeout(() => location.reload(), 1000);
    }
}

// Animate skill bars on load
document.addEventListener('DOMContentLoaded', function() {
    const skillBars = document.querySelectorAll('.bg-primary');
    skillBars.forEach((bar, index) => {
        setTimeout(() => {
            bar.style.width = bar.style.width; // Trigger animation
        }, index * 100);
    });
});
</script>
{% endblock %}
